--- 
layout: single
classes: wide
title: "[Kafka] "
header:
  overlay_image: /img/kafka-bg.jpg
excerpt: ''
author: "window_for_sun"
header-style: text
categories :
  - Kafka
tags:
    - Practice
    - Kafka
toc: true
use_math: true
---  

## CDC
`CDC` 는 `Change Data Capture` 의 약자로 데이터베이스에서 발생하는 모든 변경 사항을 실시간으로 갭쳐하고 이를 다른 시스템으로 전파하는 기술이다. 
`CDC` 는 데이터 웨어하우스, 실시간 분석, 데이터 복제 등 다양한 사례에서 활용 할 수 있다. 
이렇게 `CDC` 는 데이터베이스의 데이터를 지속적으로 모니터링하고, 
`CRUD`와 같은 변경 사항을 캡쳐해 이를 다른 데이터베이스나 시스템으로 실시간 전송 및 동기화 와 통합을 간소화하고 효율적으로 구성할 수 있다. 
이런 `CDC` 에는 `polling-based(query-based) CDC` 와 `log-based CDC` 가 있는데 여기서 `log-based CDC` 가 `polling-based CDC` 와 
비교했을 때 어떠한 장점이 있는지 살펴보고자 한다.  

### polling-based CDC
`polling-based CDC` 는 데이터베이스의 변경 사항을 주기적으로 쿼리하여 캡쳐하는 방식을 의미한다. 
이 접근 방식은 데이터베이스에 직접 쿼리를 실행하여 변경된 레코드를 검색하고 이를 다른 시스템으로 전송하게 된다. 
이러한 방식은 비교적 간단한 설정과 구현으로 사용 가능하지만, 
몇 가지 단점도 가지고 있다.  

- 주기적인 쿼리 실행 : 일정간격으로 데이터베이스에 쿼리를 실행한다. 이 쿼리는 특정 시점 이후에 변경된 레코드를 검색한다. 
- 변경된 데이터 식별 : 쿼리 결과를 바탕으로 변경된 데이터를 식별한다. 일반적으로는 `timestamp`, `last_update` 와 같은 변경 시간 필드를 기준으로 찾는다. 
- 번경 데이터 처리 : 변경된 데이터를 다른 시스템으로 전송하거나 필요한 처리를 수행한다. 
- 상태 저장 : 마지막으로 폴링한 시점이나 마지막으로 처리된 변경 사항의 `ID` 혹은 `timestamp` 와 같은 기준 값을 저장한다. 그리고 이 기준값을 바탕으로 다음 변경사항을 찾는다. 

이런 `polling-based CDC` 는 우선 구현이 비교적 간단하다. 
데이터베이스에 쿼리를 주기적으로 수행할 수만 있다면 기본적인 `CDC` 동작을 수행할 수 있기 때문이다. 
그리고 `log-based CDC` 와 비교했을 때 데이터베이스의 트랜잭션 로그에 접근하고 이와 연동이 필요 없으므로, 
애플리케이션 레벨에서 각 데이터베이스 시스템에 쿼리할 수만 있다면 데이터베이스에 종속적이지 않고 활용 가능하다.  

하지만 아래와 같은 단점이 존재한다. 

- 성능 : 주기적인 데이터베이스 쿼리는 데이터베이스에 부하를 줄 수 있다. 특히 쿼리가 복잡하거나 그 주기가 짧을 수록 부가는 증가한다. 
- 실시간성 : 변경 사항을 실시간으로 감지하지 못하고, 폴링 주기에 따른 지연을 피할 수 없다. 즉 실시간성이 요구된다면 이는 적합하지 않다. 
- 변경 누락 : 폴링 주기 도중 발생하는 변경 사항은 누락될 가능성이 있다. 레코드가 삽입되고 바로 삭제된 후 폴링을 수행한다면 해당 레코드는 누락된다. 
- 삭제 데이터 감지 : 삭제된 레코드는 쿼리 결과에 나타나지 않기 때문에 김자에 어려움이 있다. 


### log-based CDC
`log-based CDC` 는 데이터베이스의 트랜잭션 로그를 모니터링하여 변경 사항을 캡쳐하는 방식이다. 
이런 방식은 데이터베이스가 데이터를 변경할 때 생성하는 로그를 읽어 변경 사항을 실시간으로 추적하게 된다. 
`polling-based CDC` 와 비교했을 때 더 정확하면서도 효율성이 높다.  

- 트랜잭션 로그 읽기 : 데이터베이스에서 트랜잭션 로그를 읽어 변경 사항을 감지한다. 데이터베이스 트랜잭션 로그에는 모든 데이터 변경 사항(`CRUD`)이 순차적으로 기록된다. 
- 변경 이벤트 : 트랜잭션 로그에서 캡쳐한 변셩 사항을 이벤트로 생성한다. 각 이벤트는 소스가 되는 데이터베이스에서 발생한 변경 사항을 의미한다. 
- 이벤트 처리 : 생성된 변경 이벤트를 필요한 시스템으로 전송하거나 필요한 처리를 수행한다. 
- 상태유지 : 마지막으로 처리된 트랜잭션 로그 위치를 저장한다. 시스템이 재시작되거나 일시 중지된 후에도 중단된 지점부터 로그를 다시 읽을 수 있도록 하기 위함이다. 

이런 `log-based CDC` 는 아래와 같은 단점들을 가지고 있다. 

- 복잡성 : `polling-based CDC` 에 비해 설정과 구현이 복잡하다. 데이터베이스의 트랜잭션 로그에 접근해야 하므로 특정 데이터베이스의 이해까지 필요하다. 
- 트랜잭션 로그 의존성 : 데이터베이스마다 트랜잭션 로그와 형식과 접근 방식이 다르므로, 특정 데이터베이스에 종속적인 설정이 필요할 수 있다. 
- 추가 저장 공간 : 트랜잭션 로그를 보관하고 분서갛는 데 추가 저장 공간이 필요 할 수 있다.  

위와 같은 단점들이 존재하지만 대부분의 요소들은 많이 알려진 `Kafka Connect` 와 `Debezium CDC Connector` 를 활용하면 어느정도 보완이 가능한 항목들이다. 
이제 `log-based CDC` 가 `polling-based CDC` 와 비교 했을 때 가지는 5가지 장점에 대해 알아본다.  
