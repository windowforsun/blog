--- 
layout: single
classes: wide
title: "[LangGraph] LangGraph Agent Memory and Stream"
header:
  overlay_image: /img/langchain-bg-2.jpg
excerpt: ''
author: "window_for_sun"
header-style: text
categories :
  - LangGraph
tags:
    - Practice
    - LangChain
    - LangGraph
toc: true
use_math: true
---  

## Summary of LangGraph
`LangGraph` ì—ì„œ ëŒ€í™” ê¸°ë¡ì„ ì§€ì†ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì€ `AI` ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ì§€ì†ì„± íŒ¨í„´ì¤‘ í•˜ë‚˜ì´ë‹¤. 
ì´ ì ‘ê·¼ë²•ì€ ì‚¬ìš©ìì™€ `AI` ê°„ì˜ ì—°ì†ì ì¸ ìƒí˜¸ì‘ìš©ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ì—¬ ë§¥ë½ì„ ìœ ì§€í•˜ë©´ì„œ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” íë¦„ì„ ì œê³µí•œë‹¤.  

ê·¸ëŸ¬ë‚˜ ëŒ€í™” ì„¸ì…˜ì´ ì—°ì¥ë˜ê³  ë©”ì‹œì§€ê°€ ê³„ì† ì¶œì ë ìˆ˜ë¡, 
ì „ì²´ ëŒ€í™” íˆìŠ¤í† ë¦¬ê°€ ì–¸ì–´ ëª¨ë¸ì˜ `context window` ì—ì„œ ì°¨ì§€í•˜ëŠ” ë¹„ì¤‘ì´ ê¸‰ê²©íˆ ì¦ê°€í•œë‹¤. 
ì´ëŸ¬í•œ í˜„ìƒì€ ì—´ ê°€ì§€ ë¶€ì •ì ì¸ ê²°ê³¼ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆë‹¤. 

- ë¹„ìš© ì¦ê°€ : ë” ë§ì€ í† í°ì„ ì²˜ë¦¬í•´ì•¼ í•˜ë¯€ë¡œ `LLM API` í˜¸ì¶œ ë¹„ìš© ìƒìŠ¹
- ì‘ë‹µ ì§€ì—° : ê¸´ ì»¨í…ìŠ¤íŠ¸ ì²˜ë¦¬ë¡œ ì¸í•œ ì‘ë‹µ ì‹œê°„ ì¦ê°€
- ì„±ëŠ¥ ì €í•˜ : ì»¨í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¸¸ì–´ì§€ë©´ ëª¨ë¸ì˜ ì¶”ë¡  í’ˆì§ˆì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìŒ
- ë©”ëª¨ë¦¬ ì œí•œ : ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš° í•œê³„ì— ë„ë‹¬í•  ìœ„í—˜ì„±

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ íš¨ê³¼ì ìœ¼ë¡œ í•´ê²°í•˜ê¸° ìœ„í•œ ì „ëµ ì¤‘ í•˜ë‚˜ëŠ” ëŒ€í™” ìš”ì•½ ë° ì••ì¶• ê¸°ë²•ì„ í™œìš©í•˜ëŠ” ê²ƒì´ë‹¤. 
ì´ ë°©ë²•ì€ ëˆ„ì ëœ ëŒ€í™” ë‚´ìš©ì„ ê°„ê²°í•œ ìš”ì•½ë¬¸ìœ¼ë¡œ ë³€í™˜í•˜ê³ , ì´ë¥¼ ìµœê·¼ì˜ í•µì‹¬ ë©”ì‹œì§€ë“¤ê³¼ ê²°í•©í•˜ì—¬ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìµœì í™”í•˜ëŠ” ì ‘ê·¼ë²•ì´ë‹¤. 
ì´ë¥¼ ìœ„í•´ ì•„ë˜ì™€ ê°™ì€ ë‹¨ê³„ë¥¼ ê°€ì§„ë‹¤. 

- ì„ê³„ì  ê°ì§€ : ëŒ€í™” ê¸¸ì´ê°€ ë¯¸ë¦¬ ì •ì˜ëœ ê¸°ì¤€(ë©”ì‹œì§€ ê°œìˆ˜, ì´ í† í° ìˆ˜, ë¬¸ì ìˆ˜)ì„ ì´ˆê³¼í–ˆëŠ”ì§€ ëª¨ë‹ˆí„°ë§
- ì§€ëŠ¥í˜• ìš”ì•½ ìƒì„± : ëŒ€í™”ì˜ í•µì‹¬ ì •ë³´ì™€ ë§¥ë½ì„ ë³´ì¡´í•˜ë©´ì„œ ê°„ê²°í•œ ìš”ì•½ë¬¸ì„ ìƒì„±í•˜ê¸° ìœ„í•œ ì „ìš© í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§
- ì„ íƒì  ë©”ì‹œì§€ ì •ë¦¬ : ìš”ì•½ëœ ë‚´ìš©ì„ ì œíšŒí•˜ê³  ê°€ì¥ ìµœê·¼ì˜ `N`ê°œ ë©”ì‹œì§€ë§Œ ìœ ì§€í•˜ë„ë¡ ì´ì „ ë©”ì‹œì§€ë“¤ì„ ì²´ê³„ì ìœ¼ë¡œ ì œê±° 

ì´ ê³¼ì €ì—ì„œ ì£¼ìš”í•œ ë‚´ìš©ì€ `RemoveMessage` ê¸°ëŠ¥ì„ ì ì ˆíˆ í™œìš©í•´ ë©”ëª¨ë¦¬ì—ì„œ ë¶ˆí•„ìš”í•œ ëŒ€í™” ê¸°ë¡ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì œê±°í•˜ëŠ” ê²ƒì´ë‹¤. 
ì´ë¥¼ í†µí•´ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ë¥¼ ìµœì í™”í•˜ê³  ëŒ€í™”ì˜ í’ˆì§ˆì„ ì§€ì†ì ìœ¼ë¡œ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.  

`ask_llm` ì€ `messages` ë¥¼ ì‚¬ìš©í•´ `LLM` ì— ìš”ì²­ì„ ë³´ë‚´ëŠ” í•¨ìˆ˜ì´ë‹¤. 
ë‹¤ë¥¸ ì ì€ ëŒ€í™” ìš”ì•½ë³¸ì´ ì¡´ì¬í•œë‹¤ë©´ ì´ë¥¼ ì‹œìŠ¤í…œ ë©”ì‹œì§€ë¡œ ì¶”ê°€í•´ ëŒ€í™”ì— í¬í•¨ì‹œí‚¨ë‹¤.  

```python
from typing import Literal, Annotated
from langchain_core.messages import SystemMessage, RemoveMessage, HumanMessage
from langgraph.checkpoint.memory import MemorySaver
from langgraph.graph import MessagesState, StateGraph, START, END
from langgraph.graph.message import add_messages
from langchain_google_genai import ChatGoogleGenerativeAI
import os


# ìƒíƒœ ë©”ëª¨ë¦¬ ì €ì¥ì†Œ
memory = MemorySaver()

class SummaryState(MessagesState):
    messages: Annotated[list, add_messages]
    summary: str


# ëª¨ë¸ ì´ˆê¸°í™”
os.environ["GOOGLE_API_KEY"] = "AIzaSyBBWl6ZPwjUUxuYallZnZ1cEPqnQGqsVzs"
llm = ChatGoogleGenerativeAI(model="gemini-2.0-flash")

# ask_llm ë…¸ë“œ ë™ì‘ ì •ì˜
# ì´ì „ ìš”ì•½ë³¸ì´ ì¡´ì¬í•˜ë©´ ì¶”ê°€í•´ì„œ ì‚¬ìš©í•˜ê³ , ì—†ìœ¼ë©´ ì´ì „ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©í•œë‹¤.

def ask_llm(state: SummaryState):
  # ìš”ì•½ ë‚´ìš©
  summary = state.get("summary", "")

  if summary:
    system_message = f"Summary of conversation earlier: {summary}"
    messages = [SystemMessage(content=system_message)] + state["messages"]
  else:
    messages = state["messages"]

  response = llm.invoke(messages)


  return {"messages" : [response]}
```  

ê·¸ë¦¬ê³  `should_continue` í•¨ìˆ˜ëŠ” ì„ê³„ì ì„ ê°ì§€í•˜ê³ , 
ì´ˆê³¼í–ˆë‹¤ë©´ ìš”ì•½ì´ ìˆ˜í–‰ë  ìˆ˜ ìˆë„ë¡ í•œë‹¤. 
ë„˜ì§€ ì•Šì•˜ë‹¤ë©´ ì¢…ë£Œí•œë‹¤. 
ì˜ˆì œì—ì„œ ì‚¬ìš©í•˜ëŠ” ì„ê³„ì ì˜ ê¸°ì¤€ì€ ë©”ì‹œì§€ì˜ ìˆ˜ê°€ 6ê°œë¥¼ ì´ˆê³¼í•˜ëŠ” ê²ƒì´ë‹¤.  

```python
# ìš”ì•½ ê²°ì • ë…¸ë“œ ë™ì‘ ì •ì˜
# ìš”ì•½ì´ ë¶ˆí•„ìš”í•˜ë‹¤ë©´ END ë…¸ë“œë¡œ ì´ë™

def should_continue(state: SummaryState) -> Literal["summarize_conversation", END]:
  # ì§€ê¸ˆê¹Œì§€ ë©”ì‹œì§€
  messages = state["messages"]

  if len(messages) > 6:
    return "summarize_conversation"
  else:
    return END
```  

`summarize_conversation` í•¨ìˆ˜ëŠ” ë…¸ë“œì˜ ëŒ€í™”ë¥¼ ìš”ì•½í•˜ê³ , 
ì˜¤ë˜ëœ ë©”ì‹œì§€ëŠ” ì‚­ì œí•œë‹¤.  

```python
# ìš”ì•½ ìƒì„± ë° ë©”ì‹œì§€ ì‚­ì œ ë…¸ë“œ ë™ì‘ ì •ì˜
def summarize_conversation(state: SummaryState):
  # ì´ì „ ìš”ì•½ ë‚´ìš©
  summary = state.get("summary", "")

  if summary:
    summary_message = (
        f"Here is a summary of the conversation so far: {summary}\n\n"
        "Please update and expand this summary in Korean, taking into account the new messages above:"
    )
  else:
    summary_message = "Based on the messages above, write a summary in Korean."

  # ìš”ì•½ í”„ë¡¬í”„íŠ¸ì™€ ë©”ì‹œì§€ ê²°í•©
  messages = state["messages"] + [HumanMessage(content=summary_message)]
  # ìš”ì•½ ìƒì„±
  response = llm.invoke(messages)
  # ì´ì „ ë©”ì‹œì§€ ì‚­ì œ
  delete_messages = [RemoveMessage(id=m.id) for m in state["messages"][:-2]]

  return {"summary" : response.content, "messages": delete_messages}
```  

ì´ì œ ì •ì˜í•œ í•¨ìˆ˜ë¥¼ ë…¸ë“œë¡œ ë“±ë¡í•´ ê·¸ë˜í”„ë¥¼ êµ¬ì„±í•œë‹¤.  

```python
# ê·¸ë˜í”„ ì •ì˜
from IPython.display import Image, display

graph_builder = StateGraph(SummaryState)

graph_builder.add_node("conversation", ask_llm)
graph_builder.add_node(summarize_conversation)

graph_builder.add_edge(START, "conversation")

graph_builder.add_conditional_edges(
    "conversation",
    should_continue,
)

graph_builder.add_edge("summarize_conversation", END)

graph = graph_builder.compile(checkpointer=memory)


# ê·¸ë˜í”„ ì‹œê°í™”
try:
    display(Image(graph.get_graph().draw_mermaid_png()))
except Exception:
    pass
```  

![ê·¸ë¦¼ 1]({{site.baseurl}}/img/langgraph/summary-subgraph-1.png)


êµ¬í˜„ëœ ê·¸ë˜í”„ì— ëŒ€í™”ë¥¼ ì§„í–‰í•´ ê²°ê³¼ë¥¼ í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.  

```python
# ê·¸ë˜í”„ ì‹¤í–‰

def execute_graph_and_print(config, query):
  input_message = HumanMessage(content=query)
  input_message.pretty_print()

  for event in graph.stream({"messages": [input_message]}, config, stream_mode="updates"):
    # ì—…ë°ì´íŠ¸ ë”•ì…”ë„ˆë¦¬ ìˆœíšŒ
    for k, v in event.items():
        # ë©”ì‹œì§€ ëª©ë¡ ì¶œë ¥
        for m in v["messages"]:
            m.pretty_print()
        # ìš”ì•½ ì •ë³´ ì¡´ì¬ ì‹œ ì¶œë ¥
        if "summary" in v:
            print(v["summary"])

config = {"configurable": {"thread_id": "1"}}
execute_graph_and_print(config, "ì•ˆë…•? ë‚´ ì´ë¦„ì€ ì² ìˆ˜ì•¼")
# ================================ Human Message =================================
# 
# ì•ˆë…•? ë‚´ ì´ë¦„ì€ ì² ìˆ˜ì•¼
# ================================== Ai Message ==================================
# 
# ì•ˆë…•í•˜ì„¸ìš”, ì² ìˆ˜ ì”¨! ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤. ì €ëŠ” ì¸ê³µì§€ëŠ¥ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?

execute_graph_and_print(config, "ë‚´ ì´ë¦„ì´ ë­ë¼ê³  ì•Œë ¤ì¤¬ì§€ ?")
# ================================ Human Message =================================
# 
# ë‚´ ì´ë¦„ì´ ë­ë¼ê³  ì•Œë ¤ì¤¬ì§€ ?
# ================================== Ai Message ==================================
# 
# ì² ìˆ˜ ì”¨ë¼ê³  ì•Œë ¤ë“œë ¸ìŠµë‹ˆë‹¤. :)

execute_graph_and_print(config, "ë‚´ ì§ì—…ì€ ê°œë°œìì•¼")
# ================================ Human Message =================================
# 
# ë‚´ ì§ì—…ì€ ê°œë°œìì•¼
# ================================== Ai Message ==================================
# 
# ì•Œê² ìŠµë‹ˆë‹¤, ì² ìˆ˜ ì”¨. ê°œë°œìì‹œêµ°ìš”! ì–´ë–¤ ì¢…ë¥˜ì˜ ê°œë°œì„ í•˜ì‹œëŠ”ì§€ ì—¬ì­¤ë´ë„ ë ê¹Œìš”? (ë¬¼ë¡ , í¸í•˜ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”!) í˜¹ì‹œ ê°œë°œ ê´€ë ¨í•´ì„œ ì œê°€ ë„ì™€ë“œë¦´ ìˆ˜ ìˆëŠ” ë¶€ë¶„ì´ ìˆì„ê¹Œìš”?
```  

ì§€ê¸ˆê¹Œì§€ ëŒ€í™”í•œ ì‹œì ì—ì„œ ì €ì¥ëœ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ë©´ ëª¨ë“  ë©”ì‹œì§€ê°€ ì¡´ì¬í•œë‹¤. 
ì´ëŠ” ì•„ì§ ë©”ì‹œì§€ì˜ ìˆ˜ê°€ 6ê°œë¥¼ ì´ˆê³¼í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë‹¤.  

```python
# ìƒíƒœ êµ¬ì„± ê°’ ê²€ìƒ‰
values = graph.get_state(config).values
print(len(values["messages"]))
# 6

print(values)
# {'messages': [HumanMessage(content='ì•ˆë…•? ë‚´ ì´ë¦„ì€ ì² ìˆ˜ì•¼', additional_kwargs={}, response_metadata={}, id='e21137b3-ea6d-46c2-8675-8f8cfd840e45'),
#               AIMessage(content='ì•ˆë…•í•˜ì„¸ìš”, ì² ìˆ˜ ì”¨! ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤. ì €ëŠ” ì¸ê³µì§€ëŠ¥ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--eec101a1-ec90-432e-8626-b4000478e7ae-0', usage_metadata={'input_tokens': 9, 'output_tokens': 40, 'total_tokens': 49, 'input_token_details': {'cache_read': 0}}),
#               HumanMessage(content='ë‚´ ì´ë¦„ì´ ë­ë¼ê³  ì•Œë ¤ì¤¬ì§€ ?', additional_kwargs={}, response_metadata={}, id='e9d048d1-eb5e-4201-a3c3-5508e5663b64'),
#               AIMessage(content='ì² ìˆ˜ ì”¨ë¼ê³  ì•Œë ¤ë“œë ¸ìŠµë‹ˆë‹¤. :)', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2d28ff1d-8416-456d-b42a-1484aee20fed-0', usage_metadata={'input_tokens': 59, 'output_tokens': 13, 'total_tokens': 72, 'input_token_details': {'cache_read': 0}}),
#               HumanMessage(content='ë‚´ ì§ì—…ì€ ê°œë°œìì•¼', additional_kwargs={}, response_metadata={}, id='944c5f6b-8dc1-47b5-b2e9-8cc399efc8e6'),
#               AIMessage(content='ì•Œê² ìŠµë‹ˆë‹¤, ì² ìˆ˜ ì”¨. ê°œë°œìì‹œêµ°ìš”! ì–´ë–¤ ì¢…ë¥˜ì˜ ê°œë°œì„ í•˜ì‹œëŠ”ì§€ ì—¬ì­¤ë´ë„ ë ê¹Œìš”? (ë¬¼ë¡ , í¸í•˜ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”!) í˜¹ì‹œ ê°œë°œ ê´€ë ¨í•´ì„œ ì œê°€ ë„ì™€ë“œë¦´ ìˆ˜ ìˆëŠ” ë¶€ë¶„ì´ ìˆì„ê¹Œìš”?', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--6d96aad0-cd34-4fb5-acc8-3642a33f7161-0', usage_metadata={'input_tokens': 78, 'output_tokens': 71, 'total_tokens': 149, 'input_token_details': {'cache_read': 0}})]}
```  

í•œë²ˆì˜ ëŒ€í™”ë¥¼ ì¶”ê°€ë¡œ ì§„í–‰í•˜ë©´ ëŒ€í™”ê°€ ìš”ì•½ë˜ê³  `RemoveMessage` ê°€ ìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  

```python
execute_graph_and_print(config, "ë‚˜ëŠ” ìš”ì¦˜ LLMì— ëŒ€í•´ ê³µë¶€í•˜ê³  ìˆì–´")
# ================================ Human Message =================================
# 
# ë‚˜ëŠ” ìš”ì¦˜ LLMì— ëŒ€í•´ ê³µë¶€í•˜ê³  ìˆì–´
# ================================== Ai Message ==================================
# 
# ì•„, LLM(Large Language Model)ì— ëŒ€í•´ ê³µë¶€í•˜ì‹œëŠ”êµ°ìš”! ì •ë§ í¥ë¯¸ë¡œìš´ ë¶„ì•¼ì£ . LLMì€ ë‹¤ì–‘í•œ ê°€ëŠ¥ì„±ì„ ê°€ì§€ê³  ìˆì–´ì„œ ê°œë°œìë¡œì„œ í° ê¸°íšŒê°€ ë  ìˆ˜ ìˆì„ ê±°ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.
# 
# í˜¹ì‹œ LLMì— ëŒ€í•´ êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ë¶€ë¶„ì„ ê³µë¶€í•˜ê³  ê³„ì‹ ê°€ìš”? ì˜ˆë¥¼ ë“¤ì–´:
# 
# *   **LLMì˜ ì¢…ë¥˜**: GPT, BERT, LaMDA ë“± ë‹¤ì–‘í•œ ëª¨ë¸ì´ ìˆëŠ”ë°, íŠ¹ì • ëª¨ë¸ì— ì§‘ì¤‘í•˜ê³  ê³„ì‹ ê°€ìš”?
# *   **LLMì˜ í™œìš© ë¶„ì•¼**: ì±—ë´‡, í…ìŠ¤íŠ¸ ìƒì„±, ë²ˆì—­, ìš”ì•½ ë“± ì–´ë–¤ ë¶„ì•¼ì— LLMì„ ì ìš©í•˜ëŠ” ë° ê´€ì‹¬ì´ ìˆìœ¼ì‹ ê°€ìš”?
# *   **LLM ê´€ë ¨ ê¸°ìˆ **: Fine-tuning, Prompt Engineering, LangChain ë“± ì–´ë–¤ ê¸°ìˆ ì„ ë°°ìš°ê³  ê³„ì‹ ê°€ìš”?
# 
# ì–´ë–¤ ë¶€ë¶„ì„ ê³µë¶€í•˜ê³  ê³„ì‹ ì§€ ì•Œë ¤ì£¼ì‹œë©´, ì œê°€ ë” ì ì ˆí•œ ì •ë³´ë‚˜ ìë£Œë¥¼ ì°¾ì•„ë“œë¦¬ê±°ë‚˜, ì œ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì¡°ì–¸ì„ ë“œë¦´ ìˆ˜ë„ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. LLM ê³µë¶€ì— ë„ì›€ì´ ë  ë§Œí•œ ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ í¸í•˜ê²Œ ë¬¼ì–´ë³´ì„¸ìš”!
# ================================ Remove Message ================================
# 
# 
# ================================ Remove Message ================================
# 
# 
# ================================ Remove Message ================================
# 
# 
# ================================ Remove Message ================================
# 
# 
# ================================ Remove Message ================================
# 
# 
# ================================ Remove Message ================================
# 
# 
# ì² ìˆ˜ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ê°œë°œìê°€ LLM(Large Language Model)ì— ëŒ€í•´ ê³µë¶€í•˜ê³  ìˆë‹¤ê³  í•©ë‹ˆë‹¤. ì¸ê³µì§€ëŠ¥ ì–´ì‹œìŠ¤í„´íŠ¸ëŠ” ì² ìˆ˜ ì”¨ì—ê²Œ LLMì˜ ì¢…ë¥˜, í™œìš© ë¶„ì•¼, ê´€ë ¨ ê¸°ìˆ  ë“± êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ë¶€ë¶„ì„ ê³µë¶€í•˜ê³  ìˆëŠ”ì§€ ì§ˆë¬¸í•˜ë©°, í•„ìš”í•œ ì •ë³´ë‚˜ ì¡°ì–¸ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤ê³  ì œì•ˆí–ˆìŠµë‹ˆë‹¤.
```  

ë‹¤ì‹œ ìƒíƒœì—ì„œ ê´€ë¦¬ë˜ê³  ìˆëŠ” ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ë©´ ë§ˆì§€ë§‰ 2ê°œ ë©”ì‹œì§€ë§Œ ìˆê³ , 
ë‚˜ë¨¸ì§€ëŠ” ìš”ì•½ëœ ë‚´ìš©ìœ¼ë¡œ ì¡´ì¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  

```python
# ìƒíƒœ êµ¬ì„± ê°’ ê²€ìƒ‰
values = graph.get_state(config).values
print(len(values["messages"]))
# 2

print(values)
# {'messages': [HumanMessage(content='ë‚˜ëŠ” ìš”ì¦˜ LLMì— ëŒ€í•´ ê³µë¶€í•˜ê³  ìˆì–´', additional_kwargs={}, response_metadata={}, id='e03ceb93-d909-4de7-baa2-39e153a9a8dc'),
#               AIMessage(content='ì•„, LLM(Large Language Model)ì— ëŒ€í•´ ê³µë¶€í•˜ì‹œëŠ”êµ°ìš”! ì •ë§ í¥ë¯¸ë¡œìš´ ë¶„ì•¼ì£ . LLMì€ ë‹¤ì–‘í•œ ê°€ëŠ¥ì„±ì„ ê°€ì§€ê³  ìˆì–´ì„œ ê°œë°œìë¡œì„œ í° ê¸°íšŒê°€ ë  ìˆ˜ ìˆì„ ê±°ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.\n\ní˜¹ì‹œ LLMì— ëŒ€í•´ êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ë¶€ë¶„ì„ ê³µë¶€í•˜ê³  ê³„ì‹ ê°€ìš”? ì˜ˆë¥¼ ë“¤ì–´:\n\n*   **LLMì˜ ì¢…ë¥˜**: GPT, BERT, LaMDA ë“± ë‹¤ì–‘í•œ ëª¨ë¸ì´ ìˆëŠ”ë°, íŠ¹ì • ëª¨ë¸ì— ì§‘ì¤‘í•˜ê³  ê³„ì‹ ê°€ìš”?\n*   **LLMì˜ í™œìš© ë¶„ì•¼**: ì±—ë´‡, í…ìŠ¤íŠ¸ ìƒì„±, ë²ˆì—­, ìš”ì•½ ë“± ì–´ë–¤ ë¶„ì•¼ì— LLMì„ ì ìš©í•˜ëŠ” ë° ê´€ì‹¬ì´ ìˆìœ¼ì‹ ê°€ìš”?\n*   **LLM ê´€ë ¨ ê¸°ìˆ **: Fine-tuning, Prompt Engineering, LangChain ë“± ì–´ë–¤ ê¸°ìˆ ì„ ë°°ìš°ê³  ê³„ì‹ ê°€ìš”?\n\nì–´ë–¤ ë¶€ë¶„ì„ ê³µë¶€í•˜ê³  ê³„ì‹ ì§€ ì•Œë ¤ì£¼ì‹œë©´, ì œê°€ ë” ì ì ˆí•œ ì •ë³´ë‚˜ ìë£Œë¥¼ ì°¾ì•„ë“œë¦¬ê±°ë‚˜, ì œ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì¡°ì–¸ì„ ë“œë¦´ ìˆ˜ë„ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. LLM ê³µë¶€ì— ë„ì›€ì´ ë  ë§Œí•œ ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ í¸í•˜ê²Œ ë¬¼ì–´ë³´ì„¸ìš”!', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--f269a18d-a462-4c50-903e-f1e80b750866-0', usage_metadata={'input_tokens': 159, 'output_tokens': 284, 'total_tokens': 443, 'input_token_details': {'cache_read': 0}})],
#  'summary': 'ì² ìˆ˜ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ê°œë°œìê°€ LLM(Large Language Model)ì— ëŒ€í•´ ê³µë¶€í•˜ê³  ìˆë‹¤ê³  í•©ë‹ˆë‹¤. ì¸ê³µì§€ëŠ¥ ì–´ì‹œìŠ¤í„´íŠ¸ëŠ” ì² ìˆ˜ ì”¨ì—ê²Œ LLMì˜ ì¢…ë¥˜, í™œìš© ë¶„ì•¼, ê´€ë ¨ ê¸°ìˆ  ë“± êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ë¶€ë¶„ì„ ê³µë¶€í•˜ê³  ìˆëŠ”ì§€ ì§ˆë¬¸í•˜ë©°, í•„ìš”í•œ ì •ë³´ë‚˜ ì¡°ì–¸ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤ê³  ì œì•ˆí–ˆìŠµë‹ˆë‹¤.'}
```  

ì´í›„ ì‚­ì œëœ ë©”ì‹œì§€ì— ëŒ€í•œ ì§ˆë¬¸ì„ í•˜ë”ë¼ë„ ìš”ì•½ëœ ë‚´ìš©ì— ê´€ë ¨ `context` ê°€ ì¡´ì¬í•´ ëŒ€í™”ë¥¼ ì´ì–´ê°ˆ ìˆ˜ ìˆë‹¤.  

```python
execute_graph_and_print(config, "ë‚´ ì´ë¦„ê³¼ ì§ì—…ì„ ë­ë¼ê³  ì•Œë ¤ì¤¬ì§€ ?")
# ================================ Human Message =================================
# 
# ë‚´ ì´ë¦„ê³¼ ì§ì—…ì„ ë­ë¼ê³  ì•Œë ¤ì¤¬ì§€ ?
# ================================== Ai Message ==================================
# 
# ë‹¹ì‹ ì€ ì €ì—ê²Œ ë‹¹ì‹ ì˜ ì´ë¦„ì´ ì² ìˆ˜ì´ê³ , ì§ì—…ì€ ê°œë°œìë¼ê³  ì•Œë ¤ì£¼ì…¨ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  LLMì— ëŒ€í•´ ê³µë¶€í•˜ê³  ìˆë‹¤ê³  ë§ì”€í•˜ì…¨ì£ . ğŸ˜Š
```  


## Subgraph of LangGraph
`Subgraph` ê¸°ëŠ¥ì„ í™œìš©í•˜ë©´ ëŒ€ê·œëª¨ì´ê³  ë³µì¡í•œ `AI` ì›Œí¬í”Œë¡œìš° ì‹œìŠ¤í…œì„ ëª¨ë“ˆí™”ëœ êµ¬ì¡°ë¡œ ì„¤ê³„í•  ìˆ˜ ìˆë‹¤. 
ì´ ì ‘ê·¼ë²•ì—ì„œ ê°ê°ì˜ êµ¬ì„± ìš”ì†Œë“¤ì€ ë…ë¦½ì ì¸ ê·¸ë˜í”„ë¡œ êµ¬í˜„ë˜ì–´ ì „ì²´ ì‹œìŠ¤í…œì˜ í™•ì¥ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì„ í¬ê²Œ í–¥ìƒì‹œí‚¨ë‹¤. 
`Subgraph` ì˜ ê°€ì¥ ëŒ€í‘œì ì¸ í˜¸ë¼ìš© ì‚¬ë¡€ëŠ” `Multi-Agent Architecture` ë¥¼ êµ¬ì¶•í•˜ëŠ” ê²ƒìœ¼ë¡œ,
ì—¬ëŸ¬ `AI` ì—ì´ì „íŠ¸ê°€ ê°ìì˜ ì „ë¬¸ ì˜ì—­ì—ì„œ í˜‘ë ¥í•˜ì—¬ ë³µí•©ì ì¸ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œ í•œë‹¤.  

`Subgraph` ë¥¼ ì‹œìŠ¤í…œì— í†µí•©í•  ë•Œ í•µì‹¬ì ì´ê³  ê³ ë ¤í•´ì•¼ í•  ì„¤ê³„ ìš”ì†ŒëŠ” ìƒìœ„ ê·¸ë˜í”„ì™€ í•˜ìœ„ ê·¸ë˜í”„ ê°„ì˜ ë°ì´í„° í†µì‹  ë©”ì»¤ë‹ˆì¦˜ì´ë‹¤. 
íŠ¹íˆ ê·¸ë˜í”„ ì‹¤í–‰ ê³¼ì •ì—ì„œ ìƒíƒœ ì •ë³´ê°€ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ê³„ì¸µ ê°„ì— ì „ë‹¬ë˜ê³  ë™ê¸°í™”ë˜ëŠ”ì§€ê°€ ì „ì²´ ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ê³¼ ì•ˆì •ì„±ì„ ê²°ì •í•˜ëŠ” ì¤‘ìš”í•œ ìš”ì¸ì´ë‹¤.  

ì´ëŸ¬í•œ ìƒíƒœ ê´€ë¦¬ì˜ í†µì‹  íŒ¨í„´ì— ë”°ë¼ ë‹¤ìŒê³¼ ê°™ì€ ë‘ ê°€ì§€ ì£¼ìš” êµ¬í˜„ ì‹œë‚˜ë¦¬ì˜¤ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆë‹¤.  

- `Shared Schema Pattern`(ê³µìœ  ìŠ¤í‚¤ë§ˆ)
  - ìƒìœ„ ê·¸ë˜í”„ì™€ í•˜ìœ„ ê·¸ë˜í”„ê°€ ë™ì¼í•œ ìƒíƒœ ìŠ¤í‚¤ë§ˆ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì´ë‹¤. 
  - ì´ ìƒí™©ì—ì„œëŠ” ë°ì´í„° êµ¬ì¡°ì˜ í˜¸í™˜ì„±ì´ ë³´ì¥ë˜ë¯€ë¡œ, ì»´íŒŒì¼ëœ ì„œë¸Œ ê·¸ë˜í”„ë¥¼ ì§ì ‘ ë…¸ë“œë¡œ ì¶”ê°€í•˜ëŠ” ì§ì ‘ì ì¸ í†µí•© ë°©ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 
  - ì´ ì ‘ê·¼ë²•ì€ êµ¬í˜„ì´ ê°„ë‹¨í•˜ê³  ì„±ëŠ¥ìƒ ì˜¤ë²„í—¤ë“œê°€ ì ë‹¤ëŠ” ì¥ì ì„ ê°€ì§„ë‹¤. 
- `Heterogeneous Schema Pattern`(ì´ì¢… ìŠ¤í‚¤ë§ˆ)
  - ìƒìœ„ ê·¸ë˜í”„ì™€ ì„œë¸Œ ê·¸ë˜í”„ê°€ ì„œë¡œ ë‹¤ë¥¸ ìƒíƒœ ìŠ¤í‚¤ë§ˆë¥¼ ê°€ì§€ëŠ” ê²½ìš°ì´ë‹¤. 
  - ì´ëŸ¬í•œ ìƒí™©ì—ì„œëŠ” ì„œë¸Œê·¸ë˜í”„ë¥¼ í˜¸ì¶œí•˜ëŠ” ì „ìš© ë…¸ë“œ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤. 
  - ìœ„ í•¨ìˆ˜ëŠ” ë‘ ê·¸ë˜í”„ ê°„ì˜ ìƒíƒœ ë³€í™˜ ì—­í• ì„ ë°˜ë‹¹í•œë‹¤. 
  - ì´ íŒ¨í„´ì€ ë ˆê±°ì‹œ ì‹œìŠ¤í…œê³¼ í†µí•©, ì„œë¡œ ë‹¤ë¥¸ ë„ë©”ì¸ ê°„ í†µí•©, ì„œë¸Œê·¸ë˜í”„ ì „ í›„ ê²€ì¦/ì •ê·œí™”, ë³´ì•ˆìƒ ì´ìœ ë¡œ í•„í„°ë§ ë“±ì— ìœ ìš©í•˜ë‹¤. 

